

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Cellular/Battery Backed System &mdash; trigBoard
Version 8 0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="E-Paper Corona Display" href="ePaperCoronaDisplay.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> trigBoard
Version 8
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">trigBoard v8 Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="wheretobuy.html">Where To Buy</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurator.html">Configurator</a></li>
<li class="toctree-l1"><a class="reference internal" href="supportedServices.html">Supported Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hardware.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="Firmware.html">Firmware/Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing/Factory Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>
<p class="caption"><span class="caption-text">Projects</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ePaperCoronaDisplay.html">E-Paper Corona Display</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cellular/Battery Backed System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#trigboard-setup">trigBoard Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gateway-setup">Gateway Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hardware-needed">Hardware Needed</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trigboard-software">trigBoard Software</a></li>
<li class="toctree-l3"><a class="reference internal" href="#particle-software">Particle Software</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">trigBoard
Version 8</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Cellular/Battery Backed System</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/cellularProject.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cellular-battery-backed-system">
<h1>Cellular/Battery Backed System<a class="headerlink" href="#cellular-battery-backed-system" title="Permalink to this headline">¶</a></h1>
<img alt="_images/cellularBlockDiag.png" class="align-center" src="_images/cellularBlockDiag.png" />
<p>This is actually the preferred method for using the trigBoard - a complete low power system that relies on no existing WiFi/Internet and can even get push notifications out when there is a power outage!</p>
<ul class="simple">
<li>A central Gateway is installed in the system, where an ESP32 is configured to be a WiFi Access point.  By default, the SSID is hidden for security purposes.  This also means this is a private network hosted in the trigBoard system, meaning any existing WiFi is not relied upon.</li>
<li>trigBoard communication to the gateway is done using UDP messaging.  This is very fast, and since no cloud communication is needed, the trigBoard message can be sent out very quickly and it can go back to sleep faster (saves battery life). This can be setup from the configurator with the base firmware.</li>
<li>A <a class="reference external" href="https://store.particle.io/collections/cellular/products/boron-lte">Particle Boron</a> is also on the gateway to provide cellular connectivity to send push notifications without the need for existing WiFi/Internet connection.  At the time of writing this, the data plan from particle is $3/mo</li>
<li>Local monitors in the system can play mp3 files based on what even took place.  Like if the Front Door is opened, these monitors will immediately play a custom mp3 “The Front Door has Opened”  These work on the same private WiFi network hosted by the gateway - when a message is received by a trigBoard sensor, it is immediately forwarded out to monitors.</li>
<li>Battery Backed! Obviously all trigBoard sensors are all on batteries, but the gateway is battery backed by the on-board Particle Boron battery connection. The monitors are also battery backed with the use of Adafruit’s ESP32 Feather board having on-board battery connection and USB charging.</li>
<li>KD Circuits has designed simple carrier boards for gateway and monitor boards - just bare PCB here, but easy to solder together with all through hole components.  $2/pc <a class="reference external" href="https://www.kdcircuits.com#contact">contact KD Circuits directly</a></li>
</ul>
<div class="section" id="trigboard-setup">
<h2>trigBoard Setup<a class="headerlink" href="#trigboard-setup" title="Permalink to this headline">¶</a></h2>
<p>This is actually the easiest part! The messages are sent out via UDP, so setup the trigBoard as you normally would, but just enable udp from the configurator.  Timer settings, open/closed, etc… are all however you want them to work.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<div class="last line-block">
<div class="line">Three things need to be decided</div>
<div class="line">1-SSID will be whatever you want - pick something random like “ajhagwiuycgwerilucberw” just don’t use special characters</div>
<div class="line">2-Password also something random- AT LEAST 8 characters and nothing special</div>
<div class="line">3-Port for the UDP messaging, I just use 1234</div>
<div class="line"><strong>Write these down somewhere, we’ll need them for setting everything up</strong></div>
</div>
</div>
<div class="line-block">
<div class="line">Here is my setup:</div>
</div>
<img alt="_images/udpSetup_cell.png" class="align-center" src="_images/udpSetup_cell.png" />
<ul class="simple">
<li><strong>SSID</strong> Custom SSID to be used for this private network.  This is only used by trigBoards in this system, so do not use your existing WiFi credentials here.  Make something up that is totally random.  try to use just letters and numbers, like “hgkjgKJGH687G” at least 8 characters.  Keep this information somewhere secure, since we’ll need to set everything else up and other trigBoards in the future.</li>
<li><strong>Password</strong> Same as SSID, something random, at least 8 characters like “jklhoilhJLKHHj8907h”</li>
<li><strong>Static IP</strong> You can set this to 192.168.4.102 if you’d like, or give each of your trigBoards something like 192.168.4.102, 192.168.4.103, 192.168.4.104  Just make sure to start at .102 and you could even give each trigBoard the same ip address.  The only risk there is if two trigBoards are triggered at the same exact time and both have the same static IP address.</li>
<li><strong>Target IP</strong> Must be  192.168.4.1 - this is the ip Address of the gateway where the messages are all sent</li>
<li><strong>Target Port</strong> You can set this to anything you want, but I normally set to 1234</li>
<li><strong>Subnet</strong> Set to 255.255.0.0</li>
<li><strong>Primary DNS</strong> Set to 8.8.8.8</li>
<li><strong>Secondary DNS</strong> Set to 8.8.4.4</li>
<li><strong>Blast Count</strong> Here is where you can get creative - UDP is a one way kind of message service, so how do we know the message got through? Well we don’t and would take too much time to acknowledge back and forth, so best to just send a blast of messages!  I recommend 10-25 messages for this.  The battery calculations were done with a 20 message blast.</li>
<li><strong>Time Between Blasts</strong> This is the time between each message as they’re sent out.  10 has worked pretty good for all of my testing.</li>
</ul>
<div class="line-block">
<div class="line"><strong>How to set which mp3 to play on which event</strong></div>
<div class="line-block">
<div class="line">If using a Monitor to play mp3 files, setting this is done on each trigBoard through the configurator.  Very Easy! Each file on the SD card starts with a number, so these numbers are added in to the messages you set in the configurator:</div>
</div>
</div>
<img alt="_images/mp3message.png" class="align-center" src="_images/mp3message.png" />
<p>So you can see -5- or -7- or -2- is appended to the messages. If you don’t want a certain message to be played by the monitor, just don’t add the number</p>
</div>
<div class="section" id="gateway-setup">
<h2>Gateway Setup<a class="headerlink" href="#gateway-setup" title="Permalink to this headline">¶</a></h2>
<img alt="_images/gatewayPic.JPG" class="align-center" src="_images/gatewayPic.JPG" />
<div class="section" id="hardware-needed">
<h3>Hardware Needed<a class="headerlink" href="#hardware-needed" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">* trigBoard is ideal for the Private network side, but you can adapt this to any ESP32 board</div>
<div class="line">* <a class="reference external" href="https://store.particle.io/collections/cellular/products/boron-lte">Particle Boron</a></div>
<div class="line">* A good sized Lithium battery - you can see above that use a giant 5000mAh battery.  The bigger the better so that if you loose power, it will run for a long time.  <strong>The Battery plugs into the Particle Boron</strong> which supports the Adafruit Feather form factor, so any of the batteries <a class="reference external" href="https://www.adafruit.com/category/574">they sell</a> will work - always double check polarity though!!</div>
<div class="line">* You can make life a lot easier if you purchase a gateway carrier board from KD Circuits - then just some spare headers are needed to solder down the trigBoard (see picture above)</div>
</div>
<div class="line-block">
<div class="line"><strong>This is the PCB Design for reference:</strong></div>
</div>
<blockquote>
<div><img alt="_images/BoronCarrier.png" class="align-center" src="_images/BoronCarrier.png" />
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Expansion pins from the trigBoard are brought out specifically for adding lights/alarms/etc… or even a “silence button/switch”</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not connect anything to the trigBoard’s battery or sensor connectors! The battery backup is provided by the Particle Boron and continuous power is through the Boron’s micro USB port (just like the picture above)</p>
</div>
</div>
<div class="section" id="trigboard-software">
<h3>trigBoard Software<a class="headerlink" href="#trigboard-software" title="Permalink to this headline">¶</a></h3>
<p>latest code can be downloaded in the <a class="reference external" href="https://github.com/krdarrah/trigBoard_GatewayV8">Gateway Git Repository</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="simple">
<li>This is all based on the Base Firmware, so make sure you have all of those dependencies and versions of libraries installed first.</li>
<li>I use the same board settings as well</li>
<li><strong>Software Serial</strong> is used to communicate to the Particle Boron, so for the ESP32, I had to install EspSoftwareSerial first before compiling:</li>
</ul>
<img alt="_images/EspSoftwareSerialImg.png" class="align-center" src="_images/EspSoftwareSerialImg.png" />
<ul class="last simple">
<li>USB-Serial Programming is recommended</li>
</ul>
</div>
<p>Configuration of the trigBoard settings is also done through the configurator! On bootup, you’ll notice the Blue LED flashing - it will do this for about 5 minutes, allowing you to connect to it through the google chrome <a class="reference external" href="https://kevindarrah.com/configurator/">Configurator Tool</a>  You should see trigBoard Gateway now in the scan list.</p>
<blockquote>
<div><p>Because this is a Gateway acting as the Access Point, you will not be connecting to any SSID, instead you will specify the SSID and password for this private network.  Most of the functionality in the configurator - you set this here in WiFi SSID and Password - then click “Save and Connect…”</p>
<blockquote>
<div><img alt="_images/gatewayWiFiSet.png" class="align-center" src="_images/gatewayWiFiSet.png" />
</div></blockquote>
<p>Then the only other setting is when you enable UDP, you can set the port number. <strong>ALL OTHER SETTINGS DO NOTHING</strong></p>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">After saving the WiFi Settings for the gateway, <strong>YOU HAVE TO PRESS THE RESET BUTTON ON THE TRIGBOARD</strong>  This is because, the settings won’t take effect until the board boots up.  You can test things at this point with the USB-Serial Converter and look at the Serial Monitor debug window.  When a trigBoard sends a message to it, you should see some activity!</p>
</div>
</div>
<div class="section" id="particle-software">
<h3>Particle Software<a class="headerlink" href="#particle-software" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="ePaperCoronaDisplay.html" class="btn btn-neutral float-left" title="E-Paper Corona Display" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Kevin Darrah

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>