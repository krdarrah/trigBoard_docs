

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Multiple Inputs &mdash; trigBoard
Version 8 0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Temperature Logging to Grafana" href="temperatureSensor.html" />
    <link rel="prev" title="Motion Sensor - PIR" href="motionSensor.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">trigBoard v8 Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="wheretobuy.html">Where To Buy</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurator.html">Configurator</a></li>
<li class="toctree-l1"><a class="reference internal" href="supportedServices.html">Supported Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hardware.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="Firmware.html">Firmware/Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing/Factory Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>
<p class="caption"><span class="caption-text">Projects</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ePaperCoronaDisplay.html">E-Paper Corona Display</a></li>
<li class="toctree-l1"><a class="reference internal" href="cellularProject.html">Cellular/Battery Backed System</a></li>
<li class="toctree-l1"><a class="reference internal" href="doorbell.html">Door Bell Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="garage.html">Garage Door Monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="motionSensor.html">Motion Sensor - PIR</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Multiple Inputs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#connections">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code">Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#theory-of-operation">Theory of Operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quick-press-connections">Quick Press Connections</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="temperatureSensor.html">Temperature Logging to Grafana</a></li>
<li class="toctree-l1"><a class="reference internal" href="waterleakDetector.html">Water Leak Detector</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">trigBoard
Version 8</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Multiple Inputs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/multipleInputs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="multiple-inputs">
<h1>Multiple Inputs<a class="headerlink" href="#multiple-inputs" title="Permalink to this headline">¶</a></h1>
<img alt="_images/multiplepics.JPG" class="align-center" src="_images/multiplepics.JPG" />
<p>Do you have multiple inputs to monitor? Something like a pushbutton control panel? This may be an option for you!</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">This example monitors 4 normally closed push buttons, but can be modified easily to meet your needs.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This example does not maintain low current if any of the contacts remains closed! Ideally, this would be for momentary events, since when all contacts remain in the open state, the standby current is ~1-2uA</p>
</div>
<div class="section" id="connections">
<h2>Connections<a class="headerlink" href="#connections" title="Permalink to this headline">¶</a></h2>
<img alt="_images/multidiagram.png" class="align-center" src="_images/multidiagram.png" />
</div>
<div class="section" id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/krdarrah/trigBoard_Multiple">Modified Code HERE</a></p>
</div>
<div class="section" id="theory-of-operation">
<h2>Theory of Operation<a class="headerlink" href="#theory-of-operation" title="Permalink to this headline">¶</a></h2>
<p>The idea here is simple, all of the switches there are “diode OR’ed” meaning if any of them close, the they will conduct through the diode to trigger the sensor input.  But how to know which one triggered the wake? That’s the reason for the resistor dividers. Nice thing about the ESP32 is that there’s plenty of ADC pins, so just by dividing the 4.2V signal in half with x2 10k resistors, we can just scan the 4 pins and see which has a high ADC reading:</p>
<img alt="_images/scanmultiplefromsetup.png" class="align-center" src="_images/scanmultiplefromsetup.png" />
<p>That simple scan code added over in its own tab:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">scanMultiple</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">analogRead</span><span class="p">(</span><span class="n">SW1_ADC_pin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">multiMessage</span><span class="p">,</span> <span class="n">SW1_ID</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;SW1 Detected&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">analogRead</span><span class="p">(</span><span class="n">SW2_ADC_pin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">multiMessage</span><span class="p">,</span> <span class="n">SW2_ID</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;SW2 Detected&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">analogRead</span><span class="p">(</span><span class="n">SW3_ADC_pin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">multiMessage</span><span class="p">,</span> <span class="n">SW3_ID</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;SW3 Detected&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">analogRead</span><span class="p">(</span><span class="n">SW4_ADC_pin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">multiMessage</span><span class="p">,</span> <span class="n">SW4_ID</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;SW4 Detected&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The pins and messages are defined in the main file - can set those messages to anything, note max length is 10 char</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">int</span> <span class="n">SW1_ADC_pin</span> <span class="o">=</span> <span class="mi">33</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">SW2_ADC_pin</span> <span class="o">=</span> <span class="mi">34</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">SW3_ADC_pin</span> <span class="o">=</span> <span class="mi">35</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">SW4_ADC_pin</span> <span class="o">=</span> <span class="mi">39</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">char</span> <span class="n">SW1_ID</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;SW1&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="n">SW2_ID</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;SW2&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="n">SW3_ID</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;SW3&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="n">SW4_ID</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;SW4&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>So the scan tab will decide which message to use based on which is high, then in the logic tab, it will append this to the message as configured through the configurator.</p>
<p>And if using a cellular system with mp3 monitors, these messages can be used to indicate which mp3 to play:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">char</span> <span class="n">SW1_ID</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;SW1-15-&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="n">SW2_ID</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;SW2-16-&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="n">SW3_ID</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;SW3-17-&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="n">SW4_ID</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;SW4-18-&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>For example:</p>
<div style="text-align: center; margin-bottom: 2em;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/QwZ5hvTxOvk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div></div>
<div class="section" id="quick-press-connections">
<h2>Quick Press Connections<a class="headerlink" href="#quick-press-connections" title="Permalink to this headline">¶</a></h2>
<p>Since this could be for button inputs, sometimes these “presses” can be fast or a quick “tap”.  The trigBoard needs the contact input to be closed/opened for at least 200ms in order to register.  For doors/windows/etc… this doesn’t matter.  This circuit adds in the delays needed to detect a quick press and also be able to read it in after wake:</p>
<img alt="_images/multifastinput.png" class="align-center" src="_images/multifastinput.png" />
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="temperatureSensor.html" class="btn btn-neutral float-right" title="Temperature Logging to Grafana" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="motionSensor.html" class="btn btn-neutral float-left" title="Motion Sensor - PIR" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Kevin Darrah

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>